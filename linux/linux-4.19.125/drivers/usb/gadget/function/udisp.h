// ### SIPEED EDIT ###
/* SPDX-License-Identifier: GPL-2.0 */
/*
 * This header declares the utility functions used by "Gadget udisp", plus
 * interfaces to its two single-configuration function drivers.
 */

#ifndef __UDISP_H
#define __UDISP_H

#define UDISP_BULK_BUFLEN 512
#define UDISP_QLEN 8 * 64
#define UDISP_ISOC_INTERVAL 4
#define UDISP_ISOC_MAXPACKET 1024
#define UDISP_SS_BULK_QLEN 1
#define UDISP_SS_ISO_QLEN 8

#define UDISP_DEBUG 0

#if UDISP_DEBUG
#define DEBUG_LOG(fmt, ...) printk(KERN_DEBUG fmt, ##__VA_ARGS__)
#else
#define DEBUG_LOG(fmt, ...)                                                    \
	do {                                                                   \
	} while (0)
#endif

struct usb_udisp_options {
	unsigned pattern;
	unsigned isoc_interval;
	unsigned isoc_maxpacket;
	unsigned isoc_mult;
	unsigned isoc_maxburst;
	unsigned bulk_buflen;
	unsigned qlen;
	unsigned ss_bulk_qlen;
	unsigned ss_iso_qlen;
};

struct f_ss_opts {
	struct usb_function_instance func_inst;
	unsigned pattern;
	unsigned isoc_interval;
	unsigned isoc_maxpacket;
	unsigned isoc_mult;
	unsigned isoc_maxburst;
	unsigned bulk_buflen;
	unsigned bulk_qlen;
	unsigned iso_qlen;

	/*
	 * Read/write access to configfs attributes is handled by configfs.
	 *
	 * This is to protect the data from concurrent access by read/write
	 * and create symlink/remove symlink.
	 */
	struct mutex lock;
	int refcnt;
};

struct f_lb_opts {
	struct usb_function_instance func_inst;
	unsigned bulk_buflen;
	unsigned qlen;

	/*
	 * Read/write access to configfs attributes is handled by configfs.
	 *
	 * This is to protect the data from concurrent access by read/write
	 * and create symlink/remove symlink.
	 */
	struct mutex lock;
	int refcnt;
	void *ctx;
};

static const uint16_t crc16_table[256] = {
	0x0000, 0xF94F, 0x0BD1, 0xF29E, 0x17A2, 0xEEED, 0x1C73, 0xE53C, 0x2F44,
	0xD60B, 0x2495, 0xDDDA, 0x38E6, 0xC1A9, 0x3337, 0xCA78, 0x5E88, 0xA7C7,
	0x5559, 0xAC16, 0x492A, 0xB065, 0x42FB, 0xBBB4, 0x71CC, 0x8883, 0x7A1D,
	0x8352, 0x666E, 0x9F21, 0x6DBF, 0x94F0, 0xBD10, 0x445F, 0xB6C1, 0x4F8E,
	0xAAB2, 0x53FD, 0xA163, 0x582C, 0x9254, 0x6B1B, 0x9985, 0x60CA, 0x85F6,
	0x7CB9, 0x8E27, 0x7768, 0xE398, 0x1AD7, 0xE849, 0x1106, 0xF43A, 0x0D75,
	0xFFEB, 0x06A4, 0xCCDC, 0x3593, 0xC70D, 0x3E42, 0xDB7E, 0x2231, 0xD0AF,
	0x29E0, 0x836F, 0x7A20, 0x88BE, 0x71F1, 0x94CD, 0x6D82, 0x9F1C, 0x6653,
	0xAC2B, 0x5564, 0xA7FA, 0x5EB5, 0xBB89, 0x42C6, 0xB058, 0x4917, 0xDDE7,
	0x24A8, 0xD636, 0x2F79, 0xCA45, 0x330A, 0xC194, 0x38DB, 0xF2A3, 0x0BEC,
	0xF972, 0x003D, 0xE501, 0x1C4E, 0xEED0, 0x179F, 0x3E7F, 0xC730, 0x35AE,
	0xCCE1, 0x29DD, 0xD092, 0x220C, 0xDB43, 0x113B, 0xE874, 0x1AEA, 0xE3A5,
	0x0699, 0xFFD6, 0x0D48, 0xF407, 0x60F7, 0x99B8, 0x6B26, 0x9269, 0x7755,
	0x8E1A, 0x7C84, 0x85CB, 0x4FB3, 0xB6FC, 0x4462, 0xBD2D, 0x5811, 0xA15E,
	0x53C0, 0xAA8F, 0xFF91, 0x06DE, 0xF440, 0x0D0F, 0xE833, 0x117C, 0xE3E2,
	0x1AAD, 0xD0D5, 0x299A, 0xDB04, 0x224B, 0xC777, 0x3E38, 0xCCA6, 0x35E9,
	0xA119, 0x5856, 0xAAC8, 0x5387, 0xB6BB, 0x4FF4, 0xBD6A, 0x4425, 0x8E5D,
	0x7712, 0x858C, 0x7CC3, 0x99FF, 0x60B0, 0x922E, 0x6B61, 0x4281, 0xBBCE,
	0x4950, 0xB01F, 0x5523, 0xAC6C, 0x5EF2, 0xA7BD, 0x6DC5, 0x948A, 0x6614,
	0x9F5B, 0x7A67, 0x8328, 0x71B6, 0x88F9, 0x1C09, 0xE546, 0x17D8, 0xEE97,
	0x0BAB, 0xF2E4, 0x007A, 0xF935, 0x334D, 0xCA02, 0x389C, 0xC1D3, 0x24EF,
	0xDDA0, 0x2F3E, 0xD671, 0x7CFE, 0x85B1, 0x772F, 0x8E60, 0x6B5C, 0x9213,
	0x608D, 0x99C2, 0x53BA, 0xAAF5, 0x586B, 0xA124, 0x4418, 0xBD57, 0x4FC9,
	0xB686, 0x2276, 0xDB39, 0x29A7, 0xD0E8, 0x35D4, 0xCC9B, 0x3E05, 0xC74A,
	0x0D32, 0xF47D, 0x06E3, 0xFFAC, 0x1A90, 0xE3DF, 0x1141, 0xE80E, 0xC1EE,
	0x38A1, 0xCA3F, 0x3370, 0xD64C, 0x2F03, 0xDD9D, 0x24D2, 0xEEAA, 0x17E5,
	0xE57B, 0x1C34, 0xF908, 0x0047, 0xF2D9, 0x0B96, 0x9F66, 0x6629, 0x94B7,
	0x6DF8, 0x88C4, 0x718B, 0x8315, 0x7A5A, 0xB022, 0x496D, 0xBBF3, 0x42BC,
	0xA780, 0x5ECF, 0xAC51, 0x551E,
};

void lb_modexit(void);
int lb_modinit(void);

/* common utilities */
void disable_endpoints(struct usb_composite_dev *cdev, struct usb_ep *in,
		       struct usb_ep *out, struct usb_ep *iso_in,
		       struct usb_ep *iso_out);

#endif /* __UDISP_H */
// ### SIPEED EDIT END ###
